generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

enum UserRole {
  NON_CONFIRMED
  USER
  ADMIN
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String   @unique
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cars {
  id              Int           @id @default(autoincrement())
  carNumber       Int
  driverId        Int
  driverFirstName String
  driverLastName  String
  teamId          Int?
  teamName        String?
  teamLogo        String?
  carImage        String?
  flagImage       String?
  championshipId  Int
  championship    Championships @relation("ChampionshipCars", fields: [championshipId], references: [id])
  penalty         Penalty[]     @relation("carPenalty")
}

model Championships {
  id           Int     @id @default(autoincrement())
  title        String
  logo         String?
  serverName   String?
  serverPass   String?
  leagueJoinQr String?
  cars         Cars[]  @relation("ChampionshipCars")
  races        Races[] @relation("ChampionshipRaces")
}

model Countries {
  id        Int     @id @default(autoincrement())
  name      String
  imageUrl  String?
  shortName String
}

model Drivers {
  id        Int    @id @default(autoincrement())
  firstName String
  lastName  String
  country   Int?
}

model Races {
  id             Int           @id @default(autoincrement())
  name           String
  round          Int
  laps           Int
  mins           Int
  trackId        Int?
  trackMap       String?
  trackLogo      String?
  raceDateTime   DateTime
  tyres          String[]
  championshipId Int
  championship   Championships @relation("ChampionshipRaces", fields: [championshipId], references: [id])
}

model Penalty {
  id     Int  @id @default(autoincrement())
  carId  Int
  raceId Int
  points Int
  car    Cars @relation("carPenalty", fields: [carId], references: [id])
}

model Teams {
  id        Int     @id @default(autoincrement())
  name      String
  shortName String
  logoUrl   String?
  country   Int?
}

model ModItems {
  id          Int                    @id @default(autoincrement())
  name        String
  description String?
  carClass    String
  type        String
  image       String?
  logo        String?
  url         String?
  released    Boolean                @default(false)
  releaseDate DateTime?
  specs       Json?
  features    Json?
  screenshots Json?
  metadata    Json?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  authors     ModItemsAuthors[]
  authorTeams ModItemsModdingTeams[]

  @@index([released, releaseDate])
  @@index([carClass, name])
}

model Authors {
  id    Int               @id @default(autoincrement())
  name  String
  url   String?
  items ModItemsAuthors[]
}

model ModItemsAuthors {
  id       Int      @id @default(autoincrement())
  itemId   Int
  authorId Int
  role     String
  author   Authors  @relation(fields: [authorId], references: [id])
  item     ModItems @relation(fields: [itemId], references: [id])
}

model ModdingTeams {
  id              Int                    @id @default(autoincrement())
  name            String
  shortName       String
  logo            String?
  backgroundColor String?
  url             String?
  textColor       String?
  items           ModItemsModdingTeams[]
}

model ModItemsModdingTeams {
  id     Int          @id @default(autoincrement())
  itemId Int
  teamId Int
  item   ModItems     @relation(fields: [itemId], references: [id])
  team   ModdingTeams @relation(fields: [teamId], references: [id])
}
